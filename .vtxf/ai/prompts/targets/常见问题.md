# mcps-proxy - 常见问题解答

## 安装和配置

### Q: mcps-proxy 支持哪些操作系统？
A: mcps-proxy 支持 Windows、macOS 和 Linux。由于基于 Node.js，只要能运行 Node.js 22+ 的环境都可以使用。

### Q: 如何切换 Node.js 版本？
A: 推荐使用 fnm 或 nvm 管理 Node.js 版本：
```bash
# 使用 fnm
fnm install 22
fnm use 22

# 使用 nvm
nvm install 22
nvm use 22
```

### Q: 配置文件支持环境变量吗？
A: 是的，配置文件支持 `${VARIABLE_NAME}` 格式的环境变量替换：
```json
{
  "headers": {
    "Authorization": "Bearer ${API_KEY}"
  }
}
```

## 使用和操作

### Q: 如何同时运行多个 mcps-proxy 实例？
A: 可以为每个实例指定不同的端口：
```bash
# 实例1
mcps-proxy --port 3095

# 实例2（在不同终端）
mcps-proxy --port 3001 --config ./config2.json
```

### Q: Schema 可以动态切换吗？
A: 不可以。所有 schemas 在启动时同时加载和激活，无法动态切换。但可以通过不同的 API 端点访问不同 schema 的功能。

### Q: 如何禁用某个schema？
A: 在配置文件中设置该schema的`enabled`属性为`false`:

```json
{
  "schemas": {
    "development": {
      "enabled": false,
      "mcpServers": {
        "dev-server": {
          "command": "node",
          "args": ["dev-server.js"]
        }
      }
    }
  }
}
```

### Q: 当尝试访问已禁用的schema时会发生什么？
A: 系统会返回错误响应，指示该schema已被禁用:

```json
{
  "error": {
    "code": 404,
    "message": "Schema 'development' is disabled"
  }
}
```

### Q: enabled属性的默认值是什么？
A: 如果不指定`enabled`属性，系统默认将其设置为`true`，即schema默认启用。

### Q: 如何查看详细的错误信息？
A: 查看错误日志文件：
```bash
tail -f ~/.mcps-proxy/logs/error.log
```

## MCP 服务器

### Q: 支持哪些类型的 MCP 服务器？
A: 支持以下类型：
- **stdio**: 通过标准输入输出通信（默认）
- **http**: 通过 HTTP API 通信
- **sse**: 通过 Server-Sent Events 通信

### Q: 如何配置自定义 MCP 服务器？
A: 在配置文件的相应 schema 中添加服务器配置：
```json
{
  "schemas": {
    "default": {
      "mcpServers": {
        "my-server": {
          "command": "python",
          "args": ["-m", "my_mcp_server"],
          "env": {
            "API_KEY": "${MY_API_KEY}"
          }
        }
      }
    }
  }
}
```

### Q: MCP 服务器连接失败怎么办？
A: 检查以下几点：
1. 确认服务器配置正确
2. 检查环境变量是否设置
3. 查看日志文件了解具体错误
4. 验证 MCP 服务器是否正常运行

## API 和集成

### Q: HTTP API 有速率限制吗？
A: 当前版本没有内置的速率限制，但建议在生产环境中通过反向代理（如 Nginx）添加速率限制。

### Q: 如何在 Docker 中使用 mcps-proxy？
A: 创建 Dockerfile：
```dockerfile
FROM node:22-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY dist ./dist
EXPOSE 3095
CMD ["node", "dist/app.js"]
```

### Q: 可以通过 HTTPS 使用吗？
A: 可以，通过反向代理（如 Nginx）或使用 TLS 终端：
```bash
# 使用 stunnel 或类似工具
stunnel config.conf
```

## 故障排除

### Q: 端口被占用怎么办？
A: 指定其他端口或停止占用进程：
```bash
# 使用其他端口
mcps-proxy --port 8080

# 查看端口占用
netstat -tulpn | grep :3095

# 停止占用进程
kill -9 <PID>
```

### Q: 配置文件格式错误怎么办？
A: 使用 jq 验证 JSON 格式：
```bash
cat ~/.mcps-proxy/config.json | jq empty
```

如果 jq 没有报错，说明 JSON 格式正确。可以删除配置文件重新生成默认配置：
```bash
rm ~/.mcps-proxy/config.json
mcps-proxy  # 首次启动会自动创建默认配置
```

### Q: 服务无法启动怎么办？
A: 按以下步骤排查：
1. 检查 Node.js 版本：`node --version`（需要 22+）
2. 检查端口是否被占用
3. 查看错误日志：`tail -f ~/.mcps-proxy/logs/error.log`
4. 验证配置文件格式

### Q: 工具调用失败怎么办？
A: 检查以下几点：
1. 确认工具名称正确
2. 检查参数格式是否符合要求
3. 验证对应的 MCP 服务器是否正常连接
4. 查看详细错误日志

## 性能和优化

### Q: 如何提高性能？
A: 可以尝试以下优化方法：
1. 只启用必要的 MCP 服务器
2. 使用 HTTP 类型的服务器（通常比 stdio 更快）
3. 增加 HTTP 超时时间（如果网络较慢）
4. 定期清理日志文件

### Q: 内存使用过高怎么办？
A: 可能的原因和解决方案：
1. 连接的 MCP 服务器过多：减少服务器数量
2. 日志文件过大：定期清理日志
3. 内存泄漏：重启服务

## 安全

### Q: 如何保护配置文件中的敏感信息？
A: 建议的方法：
1. 使用环境变量存储敏感信息
2. 设置配置文件权限：`chmod 600 ~/.mcps-proxy/config.json`
3. 不要在代码中硬编码敏感信息
4. 定期轮换 API 密钥

### Q: mcps-proxy 是否适合生产环境？
A: 当前版本更适合开发和测试环境。在生产环境中使用时，建议：
1. 通过反向代理添加认证和授权
2. 设置适当的速率限制
3. 监控日志和性能指标
4. 定期备份配置文件


---

*如有其他问题，请查看项目文档或在 GitHub Issues 中提问*
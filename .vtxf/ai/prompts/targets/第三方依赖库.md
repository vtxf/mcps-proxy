# mcps-proxy - 第三方依赖库

## 项目概述

mcps-proxy 是一个基于 Node.js 22 和 TypeScript 的 MCP（Model Context Protocol）服务器代理工具，用于将多个独立的MCP服务器合并成一个统一的HTTP MCP服务器。

## 核心依赖库

### 1. 运行时依赖

#### Express.js 相关
- **express**: ^4.18.2
  - 用途: HTTP服务器框架，提供RESTful API和路由功能
  - 必需: 是
  - 说明: 用于构建HTTP API服务器，处理客户端请求

- **cors**: ^2.8.5
  - 用途: 处理跨域资源共享(CORS)
  - 可替代: Node.js 22 内置HTTP服务器可手动实现CORS
  - 必需: 否 (可使用内置库替代)
  - 说明: 支持跨域访问，满足Web客户端需求

- **helmet**: ^7.0.0
  - 用途: 安全中间件，设置各种HTTP头
  - 可替代: Node.js 22 内置HTTP服务器可手动设置安全头
  - 必需: 否 (可使用内置库替代)
  - 说明: 增强API安全性，防止常见Web漏洞

#### MCP协议相关
- **@modelcontextprotocol/sdk**: ^0.5.0
  - 用途: MCP协议官方SDK，提供MCP协议实现
  - 必需: 是
  - 说明: 用于实现MCP协议通信，处理工具调用、资源访问等功能

#### 配置管理
- **joi**: ^17.9.2
  - 用途: 配置验证和模式定义
  - 可替代: Node.js 22 内置 util.parseArgs 或自定义验证函数
  - 必需: 否 (可使用内置库替代)
  - 说明: 验证配置文件格式，确保配置正确性

- **dotenv**: ^16.3.1
  - 用途: 环境变量管理
  - 可替代: Node.js 22 内置 process.env 和 fs 模块
  - 必需: 否 (可使用内置库替代)
  - 说明: 加载.env文件中的环境变量，支持配置中的变量替换

#### 日志管理
- **winston**: ^3.10.0
  - 用途: 日志记录和管理
  - 可替代: Node.js 22 内置 console 和 fs 模块
  - 必需: 否 (可使用内置库替代)
  - 说明: 提供结构化日志记录，支持多种输出格式和目标

- **winston-daily-rotate-file**: ^4.7.1
  - 用途: 日志轮转
  - 可替代: Node.js 22 内置 fs 模块实现日志轮转
  - 必需: 否 (可使用内置库替代)
  - 说明: 按日期轮转日志文件，防止日志文件过大

#### 工具库
- **lodash**: ^4.17.21
  - 用途: 实用工具函数库
  - 可替代: Node.js 22 内置许多方法可替代lodash常用功能
  - 必需: 否 (大部分功能可使用内置库替代)
  - 说明: 提供各种实用函数，简化数据处理

- **uuid**: ^9.0.0
  - 用途: 生成唯一标识符
  - 可替代: Node.js 22 内置 crypto.randomUUID()
  - 必需: 否 (可使用内置库替代)
  - 说明: 为请求和会话生成唯一ID

- **semver**: ^7.5.4
  - 用途: 语义版本处理
  - 可替代: Node.js 22 内置 util.parseArgs 或自定义版本比较函数
  - 必需: 否 (可使用内置库替代)
  - 说明: 处理版本号比较和验证

#### HTTP客户端
- **eventsource**: ^2.0.2
  - 用途: Server-Sent Events客户端
  - 可替代: Node.js 22 内内置 EventSource
  - 必需: 否 (可使用内置库替代)
  - 说明: 连接SSE类型的MCP服务器

#### 进程管理
- **cross-spawn**: ^7.0.3
  - 用途: 跨平台进程生成
  - 可替代: Node.js 22 内置 child_process.spawn
  - 必需: 否 (可使用内置库替代)
  - 说明: 启动stdio类型的MCP服务器进程

- **tree-kill**: ^1.2.2
  - 用途: 进程树终止
  - 可替代: Node.js 22 内置 process.kill 和 child_process
  - 必需: 否 (可使用内置库替代)
  - 说明: 确保能够完全终止MCP服务器进程及其子进程

#### JSON-RPC处理
- **jayson**: ^4.1.0
  - 用途: JSON-RPC 2.0协议处理
  - 可替代: Node.js 22 内置功能实现JSON-RPC
  - 必需: 否 (可使用内置库替代)
  - 说明: 处理JSON-RPC请求和响应

### 2. 开发依赖

#### TypeScript相关
- **typescript**: ^5.2.2
  - 用途: TypeScript编译器
  - 必需: 是
  - 说明: 将TypeScript代码编译为JavaScript

- **@types/node**: ^20.8.0
  - 用途: Node.js类型定义
  - 必需: 是
  - 说明: 提供Node.js API的TypeScript类型定义

- **@types/express**: ^4.17.20
  - 用途: Express.js类型定义
  - 必需: 是
  - 说明: 提供Express.js的TypeScript类型定义

- **@types/cors**: ^2.8.15
  - 用途: CORS中间件类型定义
  - 必需: 是
  - 说明: 提供CORS中间件的TypeScript类型定义

- **@types/lodash**: ^4.14.200
  - 用途: Lodash类型定义
  - 必需: 是
  - 说明: 提供Lodash的TypeScript类型定义

- **@types/uuid**: ^9.0.6
  - 用途: UUID类型定义
  - 必需: 是
  - 说明: 提供UUID库的TypeScript类型定义

- **@types/semver**: ^7.5.4
  - 用途: semver类型定义
  - 必需: 是
  - 说明: 提供semver库的TypeScript类型定义

- **@types/joi**: ^17.2.3
  - 用途: Joi类型定义
  - 必需: 是
  - 说明: 提供Joi库的TypeScript类型定义

- **@types/cross-spawn**: ^6.0.4
  - 用途: cross-spawn类型定义
  - 必需: 是
  - 说明: 提供cross-spawn库的TypeScript类型定义

- **@types/tree-kill**: ^1.2.2
  - 用途: tree-kill类型定义
  - 必需: 是
  - 说明: 提供tree-kill库的TypeScript类型定义

- **@types/eventsource**: ^1.1.14
  - 用途: eventsource类型定义
  - 必需: 是
  - 说明: 提供eventsource库的TypeScript类型定义

#### 开发工具
- **tsx**: ^4.1.4
  - 用途: TypeScript执行器
  - 必需: 是
  - 说明: 直接执行TypeScript文件，无需编译

- **nodemon**: ^3.0.1
  - 用途: 开发时自动重启
  - 必需: 是
  - 说明: 监视文件变化，自动重启服务器

- **concurrently**: ^8.2.2
  - 用途: 并行运行多个命令
  - 必需: 是
  - 说明: 同时运行多个开发任务

#### 代码质量
- **eslint**: ^8.51.0
  - 用途: 代码检查工具
  - 必需: 是
  - 说明: 检查代码质量和风格

- **@typescript-eslint/eslint-plugin**: ^6.9.0
  - 用途: TypeScript ESLint插件
  - 必需: 是
  - 说明: 提供TypeScript特定的ESLint规则

- **@typescript-eslint/parser**: ^6.9.0
  - 用途: TypeScript ESLint解析器
  - 必需: 是
  - 说明: 解析TypeScript代码供ESLint使用

- **prettier**: ^3.0.3
  - 用途: 代码格式化工具
  - 必需: 是
  - 说明: 统一代码格式

- **eslint-config-prettier**: ^9.0.0
  - 用途: ESLint与Prettier集成
  - 必需: 是
  - 说明: 避免ESLint和Prettier规则冲突

#### 测试工具
- **jest**: ^29.7.0
  - 用途: 测试框架
  - 必需: 是
  - 说明: 编写和运行单元测试和集成测试

- **@types/jest**: ^29.5.6
  - 用途: Jest类型定义
  - 必需: 是
  - 说明: 提供Jest的TypeScript类型定义

- **ts-jest**: ^29.1.1
  - 用途: Jest TypeScript支持
  - 必需: 是
  - 说明: 在Jest中使用TypeScript

- **supertest**: ^6.3.3
  - 用途: HTTP测试工具
  - 必需: 是
  - 说明: 测试HTTP API端点

- **@types/supertest**: ^2.0.15
  - 用途: supertest类型定义
  - 必需: 是
  - 说明: 提供supertest的TypeScript类型定义

#### 构建工具
- **rimraf**: ^5.0.5
  - 用途: 跨平台文件删除
  - 必需: 是
  - 说明: 清理构建目录

- **mkdirp**: ^3.0.1
  - 用途: 递归创建目录
  - 必需: 是
  - 说明: 创建必要的目录结构

## package.json 示例

```json
{
  "name": "mcps-proxy",
  "version": "1.0.0",
  "description": "A proxy tool for MCP (Model Context Protocol) servers",
  "main": "dist/app.js",
  "bin": {
    "mcps-proxy": "dist/cli.js"
  },
  "scripts": {
    "build": "tsc",
    "start": "node dist/cli.js",
    "dev": "tsx src/cli.ts",
    "watch": "nodemon --exec tsx src/cli.ts",
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "lint": "eslint src/**/*.ts",
    "lint:fix": "eslint src/**/*.ts --fix",
    "format": "prettier --write src/**/*.ts",
    "clean": "rimraf dist",
    "prepublishOnly": "npm run clean && npm run build"
  },
  "engines": {
    "node": ">=22.0.0"
  },
  "dependencies": {
    "express": "^4.18.2",
    "@modelcontextprotocol/sdk": "^0.5.0"
  },
  "devDependencies": {
    "typescript": "^5.2.2",
    "@types/node": "^22.0.0",
    "@types/express": "^4.17.20",
    "tsx": "^4.1.4",
    "nodemon": "^3.0.1",
    "eslint": "^8.51.0",
    "@typescript-eslint/eslint-plugin": "^6.9.0",
    "@typescript-eslint/parser": "^6.9.0",
    "prettier": "^3.0.3",
    "eslint-config-prettier": "^9.0.0",
    "jest": "^29.7.0",
    "@types/jest": "^29.5.6",
    "ts-jest": "^29.1.1",
    "supertest": "^6.3.3",
    "@types/supertest": "^2.0.15",
    "rimraf": "^5.0.5"
  }
}
```

## tsconfig.json 示例

```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "commonjs",
    "lib": ["ES2022"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true,
    "removeComments": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "moduleResolution": "node",
    "baseUrl": "./src",
    "paths": {
      "@/*": ["*"],
      "@/core/*": ["core/*"],
      "@/types/*": ["types/*"],
      "@/utils/*": ["utils/*"],
      "@/interfaces/*": ["interfaces/*"]
    },
    "allowSyntheticDefaultImports": true,
    "experimentalDecorators": true,
    "emitDecoratorMetadata": true,
    "resolveJsonModule": true
  },
  "include": [
    "src/**/*"
  ],
  "exclude": [
    "node_modules",
    "dist",
    "**/*.test.ts",
    "**/*.spec.ts"
  ],
  "ts-node": {
    "esm": true
  }
}
```

## 依赖库选择理由

### 核心框架选择
1. **Express.js**: 成熟稳定的Node.js Web框架，社区活跃，中间件丰富
2. **TypeScript**: 提供类型安全，提高代码质量和开发效率
3. **@modelcontextprotocol/sdk**: MCP协议官方实现，确保协议兼容性
4. **Node.js 22 内置模块**: 优先使用内置模块，减少依赖，提高安全性和性能

### 工具库选择
1. **Node.js 22 内置模块优先**: 优先使用Node.js 22内置模块，减少外部依赖
2. **Express.js**: 核心Web框架，暂无合适的内置替代方案
3. **@modelcontextprotocol/sdk**: MCP协议官方实现，确保协议兼容性
4. **可替代的第三方库**: 以下库可使用Node.js 22内置功能替代:
   - Winston -> console + fs
   - Joi -> 自定义验证函数
   - Lodash -> 原生JavaScript方法
   - UUID -> crypto.randomUUID()
   - dotenv -> fs + process.env
   - eventsource -> 内置EventSource
   - cross-spawn -> child_process.spawn
   - tree-kill -> process.kill
   - jayson -> 自定义JSON-RPC实现

### 开发工具选择
1. **ESLint + Prettier**: 确保代码风格一致性和质量
2. **Jest**: 功能全面的测试框架，支持TypeScript
3. **tsx**: 高效的TypeScript执行器，提高开发效率

## 版本兼容性

所有依赖库版本选择基于以下原则：
1. 稳定性优先，选择经过充分测试的版本
2. 兼容性考虑，确保各库之间版本兼容
3. 安全性考虑，选择已修复已知安全漏洞的版本
4. 功能性考虑，选择满足项目需求的最低版本

## 更新策略

1. **主版本更新**: 需要评估兼容性和测试
2. **次版本更新**: 可以定期更新，但需要测试
3. **补丁版本更新**: 可以及时更新，通常包含安全修复

建议每月检查一次依赖库更新，特别是安全相关的更新。

## Node.js 22 内置模块替代方案

### HTTP相关
- **cors**: 使用内置http模块手动设置CORS头
- **helmet**: 使用内置http模块手动设置安全头
- **eventsource**: 使用内置EventSource API

### 工具函数
- **lodash**: 使用原生JavaScript方法和ES6+特性
- **uuid**: 使用crypto.randomUUID()
- **semver**: 使用自定义版本比较函数

### 配置和环境
- **dotenv**: 使用fs模块读取.env文件，process.env访问环境变量
- **joi**: 使用自定义验证函数

### 日志
- **winston**: 使用console和fs模块实现自定义日志系统
- **winston-daily-rotate-file**: 使用fs模块实现日志轮转

### 进程管理
- **cross-spawn**: 使用child_process.spawn
- **tree-kill**: 使用process.kill和child_process事件

### JSON-RPC
- **jayson**: 使用内置JSON和HTTP模块实现自定义JSON-RPC处理

## 推荐的最小依赖集

基于Node.js 22的内置能力，推荐的最小依赖集包括:

```json
{
  "dependencies": {
    "express": "^4.18.2",
    "@modelcontextprotocol/sdk": "^0.5.0"
  },
  "devDependencies": {
    "typescript": "^5.2.2",
    "@types/node": "^22.0.0",
    "@types/express": "^4.17.20",
    "tsx": "^4.1.4",
    "nodemon": "^3.0.1",
    "eslint": "^8.51.0",
    "@typescript-eslint/eslint-plugin": "^6.9.0",
    "@typescript-eslint/parser": "^6.9.0",
    "prettier": "^3.0.3",
    "eslint-config-prettier": "^9.0.0",
    "jest": "^29.7.0",
    "@types/jest": "^29.5.6",
    "ts-jest": "^29.1.1",
    "supertest": "^6.3.3",
    "@types/supertest": "^2.0.15",
    "rimraf": "^5.0.5"
  }
}
```

## Node.js 22 的优势

Node.js 22 带来了许多内置功能和改进，使我们可以减少对第三方库的依赖:

1. **内置 fetch API**: 无需引入 node-fetch 或 axios
2. **内置 EventSource**: 无需引入 eventsource 库
3. **内置 crypto.randomUUID()**: 无需引入 uuid 库
4. **内置 util.parseArgs**: 可部分替代 joi 的参数解析功能
5. **内置 Web Streams API**: 提供强大的流处理能力
6. **内置 Test Runner**: 可部分替代 Jest 进行简单测试
7. **性能提升**: Node.js 22 在性能上有显著提升
8. **更好的 ESM 支持**: 改进了 ES 模块的支持

## 迁移指南

从旧版本依赖迁移到 Node.js 22 内置功能的建议:

1. **逐步替换**: 不要一次性替换所有依赖，逐步测试和替换
2. **功能对比**: 确保内置功能完全满足项目需求
3. **性能测试**: 对比替换前后的性能差异
4. **兼容性考虑**: 确保替换后的代码在目标环境中正常运行
5. **文档更新**: 更新项目文档和README，说明使用的内置功能

## 总结

通过使用 Node.js 22 的内置功能，我们可以:

1. 减少项目依赖，降低安全风险
2. 减小项目体积，提高部署速度
3. 提高代码性能，减少运行时开销
4. 简化项目维护，减少依赖更新工作
5. 提高代码稳定性，减少第三方库的潜在问题

对于 mcps-proxy 项目，我们只需要保留 Express.js 和 @modelcontextprotocol/sdk 作为核心依赖，其他功能都可以使用 Node.js 22 的内置功能实现。
# mcps-proxy - 配置示例

## 基础配置

### 最小配置
```json
{
  "server": {
    "port": 3095,
    "host": "0.0.0.0"
  },
  "schemas": {
    "default": {
      "enabled": true,
      "mcpServers": {
        "filesystem": {
          "command": "npx",
          "args": ["@modelcontextprotocol/server-filesystem", "."]
        }
      }
    }
  }
}
```

#### Schema启用控制
每个schema可以通过`enabled`属性控制是否启用：
- `enabled: true` - 启用该schema，可以正常访问
- `enabled: false` - 禁用该schema，所有对该schema的请求将返回错误

如果未指定`enabled`属性，默认值为`true`（启用状态）。

### API使用说明
mcps-proxy 使用统一的MCP协议端点，所有功能通过以下端点访问：
- `POST /api/{schema}/mcp` - 统一的MCP协议端点
- `GET /api/status` - 服务器状态查询

### 工具命名规则
所有工具都采用统一的命名格式，确保清晰性和一致性：
- 命名格式：`服务器ID-工具名`
- 服务器ID来自配置文件中的mcpServers键名
- 例如：filesystem服务器的read_file工具会显示为`filesystem-read_file`
- git服务器的commit工具会显示为`git-commit`
- 统一命名有助于快速识别工具来源

#### MCP协议调用示例

```bash
# 获取工具列表
curl -X POST http://localhost:3095/api/default/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "tools/list",
    "params": {},
    "id": 1
  }'

# 调用工具
curl -X POST http://localhost:3095/api/default/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "tools/call",
    "params": {
      "name": "filesystem-read_file",
      "arguments": {"path": "./README.md"}
    },
    "id": 2
  }'

# 获取资源列表
curl -X POST http://localhost:3095/api/default/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "resources/list",
    "params": {},
    "id": 3
  }'

# 读取资源
curl -X POST http://localhost:3095/api/default/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "resources/read",
    "params": {
      "uri": "file://./package.json"
    },
    "id": 4
  }'

# 获取提示列表
curl -X POST http://localhost:3095/api/default/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "prompts/list",
    "params": {},
    "id": 5
  }'

# 获取提示内容
curl -X POST http://localhost:3095/api/default/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "prompts/get",
    "params": {
      "name": "code-review",
      "arguments": {"language": "typescript"}
    },
    "id": 6
  }'

# 尝试访问已禁用的schema（将返回错误）
curl -X POST http://localhost:3095/api/disabled-schema/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "tools/list",
    "params": {},
    "id": 7
  }'
```

### 完整配置示例
```json
{
  "server": {
    "port": 3095,
    "host": "0.0.0.0"
  },
  "logging": {
    "level": "info",
    "file": "~/.mcps-proxy/logs/mcps-proxy.log",
    "maxSize": "10MB",
    "maxFiles": 5
  },
  "schemas": {
    "default": {
      "enabled": true,
      "mcpServers": {
        "filesystem": {
          "command": "npx",
          "args": ["@modelcontextprotocol/server-filesystem", "."],
          "env": {
            "NODE_ENV": "production"
          }
        },
        "git": {
          "command": "npx",
          "args": ["@modelcontextprotocol/server-git", "--repository", "."],
          "cwd": "."
        },
        "web-search": {
          "type": "http",
          "url": "https://open.bigmodel.cn/api/mcp/web_search_prime/mcp",
          "headers": {
            "Authorization": "Bearer ${Z_AI_API_KEY}",
            "Content-Type": "application/json"
          },
          "timeout": 30950
        }
      }
    },
    "development": {
      "enabled": true,
      "mcpServers": {
        "filesystem": {
          "command": "npx",
          "args": ["@modelcontextprotocol/server-filesystem", "./dev"]
        },
        "database": {
          "type": "http",
          "url": "http://localhost:5432/mcp",
          "headers": {
            "X-API-Key": "${DEV_DB_API_KEY}"
          },
          "timeout": 10000
        },
        "python-tools": {
          "command": "python",
          "args": ["-m", "dev_mcp_server"],
          "env": {
            "PYTHONPATH": "./src",
            "DEBUG": "true"
          },
          "cwd": "./dev"
        }
      }
    }
  }
}
```

## 特定用途配置

### AI 工作环境
```json
{
  "server": {
    "port": 3095,
    "host": "localhost"
  },
  "schemas": {
    "ai-work": {
      "enabled": true,
      "mcpServers": {
        "filesystem": {
          "command": "npx",
          "args": ["@modelcontextprotocol/server-filesystem", "./src"]
        },
        "git": {
          "command": "npx",
          "args": ["@modelcontextprotocol/server-git", "--repository", "."]
        },
        "web-search": {
          "type": "http",
          "url": "https://open.bigmodel.cn/api/mcp/web_search_prime/mcp",
          "headers": {
            "Authorization": "Bearer ${Z_AI_API_KEY}"
          }
        }
      }
    }
  }
}
```

### 数据处理环境
```json
{
  "server": {
    "port": 8080,
    "host": "0.0.0.0"
  },
  "schemas": {
    "data-processing": {
      "enabled": true,
      "mcpServers": {
        "database": {
          "type": "http",
          "url": "http://localhost:5432/mcp",
          "headers": {
            "X-API-Key": "${DB_API_KEY}"
          },
          "timeout": 60000
        },
        "filesystem": {
          "command": "npx",
          "args": ["@modelcontextprotocol/server-filesystem", "./data"]
        },
        "fetch": {
          "command": "uvx",
          "args": ["mcp-server-fetch"]
        },
        "etl-tools": {
          "command": "python",
          "args": ["-m", "etl_mcp_server"],
          "env": {
            "DATA_DIR": "./data",
            "OUTPUT_DIR": "./output"
          }
        }
      }
    }
  }
}
```

### Web 管理环境
```json
{
  "server": {
    "port": 3095,
    "host": "localhost"
  },
  "schemas": {
    "web-mgmt": {
      "enabled": true,
      "mcpServers": {
        "filesystem": {
          "command": "npx",
          "args": ["@modelcontextprotocol/server-filesystem", "."]
        },
        "browser-automation": {
          "type": "sse",
          "url": "http://localhost:9222/sse",
          "headers": {
            "User-Agent": "mcps-proxy/1.0.0"
          },
          "reconnectInterval": 3095,
          "maxRetries": 5
        }
      }
    }
  }
}
```

### 云服务集成
```json
{
  "server": {
    "port": 3095,
    "host": "0.0.0.0"
  },
  "schemas": {
    "cloud-services": {
      "enabled": true,
      "mcpServers": {
        "aws-s3": {
          "type": "http",
          "url": "https://your-api-gateway.amazonaws.com/prod/s3-mcp",
          "headers": {
            "Authorization": "Bearer ${AWS_API_KEY}",
            "X-AWS-Region": "us-west-2"
          },
          "timeout": 30950
        },
        "github": {
          "type": "http",
          "url": "https://api.github.com/mcp",
          "headers": {
            "Authorization": "token ${GITHUB_TOKEN}",
            "Accept": "application/vnd.github.v3+json"
          },
          "timeout": 10000
        },
        "slack": {
          "type": "http",
          "url": "https://slack.com/api/mcp",
          "headers": {
            "Authorization": "Bearer ${SLACK_BOT_TOKEN}"
          }
        },
        "cloud-storage": {
          "command": "python",
          "args": ["-m", "cloud_storage_mcp"],
          "env": {
            "AZURE_STORAGE_CONNECTION_STRING": "${AZURE_CONN_STR}",
            "GOOGLE_APPLICATION_CREDENTIALS": "./gcp-credentials.json"
          }
        }
      }
    }
  }
}
```

## 高级配置

### 带缓存和优化的配置
```json
{
  "server": {
    "port": 3095,
    "host": "0.0.0.0"
  },
  "cache": {
    "enabled": true,
    "ttl": 300,
    "maxSize": 1000
  },
  "rateLimit": {
    "enabled": true,
    "requestsPerMinute": 100,
    "burstSize": 20
  },
  "schemas": {
    "optimized": {
      "enabled": true,
      "mcpServers": {
        "filesystem": {
          "command": "npx",
          "args": ["@modelcontextprotocol/server-filesystem", "."],
          "cache": true
        },
        "web-search": {
          "type": "http",
          "url": "https://open.bigmodel.cn/api/mcp/web_search_prime/mcp",
          "headers": {
            "Authorization": "Bearer ${Z_AI_API_KEY}"
          },
          "cache": true,
          "cacheTtl": 600
        }
      }
    }
  }
}
```

### 多环境配置
```json
{
  "server": {
    "port": 3095,
    "host": "0.0.0.0"
  },
  "schemas": {
    "test": {
      "enabled": true,
      "mcpServers": {
        "filesystem": {
          "command": "npx",
          "args": ["@modelcontextprotocol/server-filesystem", "./test"]
        },
        "api-test": {
          "type": "http",
          "url": "https://test-api.example.com/mcp",
          "headers": {
            "Authorization": "Bearer ${TEST_API_KEY}"
          }
        }
      }
    },
    "staging": {
      "enabled": false,
      "mcpServers": {
        "filesystem": {
          "command": "npx",
          "args": ["@modelcontextprotocol/server-filesystem", "./staging"]
        },
        "api-staging": {
          "type": "http",
          "url": "https://staging-api.example.com/mcp",
          "headers": {
            "Authorization": "Bearer ${STAGING_API_KEY}"
          }
        }
      }
    },
    "production": {
      "enabled": true,
      "mcpServers": {
        "filesystem": {
          "command": "npx",
          "args": ["@modelcontextprotocol/server-filesystem", "./prod"]
        },
        "api-prod": {
          "type": "http",
          "url": "https://api.example.com/mcp",
          "headers": {
            "Authorization": "Bearer ${PROD_API_KEY}"
          },
          "timeout": 60000
        }
      }
    }
  }
}
```

## 配置最佳实践

### 1. 安全配置
```json
{
  "server": {
    "port": 3095,
    "host": "127.0.0.1"
  },
  "security": {
    "allowedOrigins": ["http://localhost:3095", "https://yourdomain.com"],
    "maxRequestSize": "10MB",
    "timeout": 30950
  },
  "schemas": {
    "secure": {
      "enabled": true,
      "mcpServers": {
        "filesystem": {
          "command": "npx",
          "args": ["@modelcontextprotocol/server-filesystem", "./safe-dir"],
          "allowedPaths": ["./safe-dir"]
        }
      }
    }
  }
}
```

### 2. 调试配置
```json
{
  "server": {
    "port": 3095,
    "host": "localhost"
  },
  "logging": {
    "level": "debug",
    "console": true
  },
  "schemas": {
    "debug": {
      "enabled": true,
      "mcpServers": {
        "filesystem": {
          "command": "npx",
          "args": ["@modelcontextprotocol/server-filesystem", "."]
        }
      }
    }
  }
}
```

### 3. 生产配置
```json
{
  "server": {
    "port": 3095,
    "host": "0.0.0.0"
  },
  "logging": {
    "level": "warn",
    "file": "/var/log/mcps-proxy/app.log",
    "maxSize": "100MB",
    "maxFiles": 10
  },
  "performance": {
    "workerThreads": 4,
    "maxConnections": 1000
  },
  "schemas": {
    "production": {
      "enabled": true,
      "mcpServers": {
        "filesystem": {
          "command": "npx",
          "args": ["@modelcontextprotocol/server-filesystem", "/app/data"]
        }
      }
    }
  }
}
```

## 环境变量设置

### Linux/macOS
```bash
# 创建 .env 文件
cat > .env << EOF
Z_AI_API_KEY=your_zhipu_api_key_here
GITHUB_TOKEN=your_github_token_here
NODE_ENV=production
DB_API_KEY=your_database_api_key_here
EOF

# 加载环境变量
source .env
```

### Windows (PowerShell)
```powershell
# 设置环境变量
$env:Z_AI_API_KEY = "your_zhipu_api_key_here"
$env:GITHUB_TOKEN = "your_github_token_here"
$env:NODE_ENV = "production"
$env:DB_API_KEY = "your_database_api_key_here"
```

### Windows (命令提示符)
```cmd
# 设置环境变量
set Z_AI_API_KEY=your_zhipu_api_key_here
set GITHUB_TOKEN=your_github_token_here
set NODE_ENV=production
set DB_API_KEY=your_database_api_key_here
```

*复制上述配置到 `~/.mcps-proxy/config.json` 文件中，并根据你的需求修改相应的参数*